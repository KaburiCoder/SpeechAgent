<Window x:Class="SpeechAgent.Features.Settings.FindWin.FindWinImageView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:SpeechAgent.Features.Settings.FindWin"
        xmlns:controls="clr-namespace:SpeechAgent.Features.Settings.FindWin.Controls"
        mc:Ignorable="d"
        Title="Image Control Finder" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- Top Control Area -->
    <Grid Grid.Row="0" Margin="0,0,0,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Left: Scan Button -->
      <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
        <Button Content="스캔"
                Command="{Binding StartScanCommand}"
                Width="120"
                Height="40"
                Margin="0,0,10,0"
                FontSize="14"
                FontWeight="Bold"
                Background="#007ACC"
                Foreground="White"
                BorderThickness="0">
          <Button.Style>
            <Style TargetType="Button">
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate TargetType="Button">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="5">
                      <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
              <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                  <Setter Property="Background" Value="#005A9E"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                  <Setter Property="Background" Value="#004080"/>
                </Trigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>
        <TextBlock Text="로딩 중..."
                   VerticalAlignment="Center"
                   Margin="20,0,0,0"
                   FontSize="14"
                   Foreground="Gray"
                   Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>
      </StackPanel>

      <!-- Right: Send to Settings Button -->
      <Button Grid.Column="1"
              Content="설정으로 전송"
              Command="{Binding SendToSettingsCommand}"
              Width="120"
              Height="40"
              HorizontalAlignment="Right"
              FontSize="14"
              FontWeight="Bold"
              Background="#28A745"
              Foreground="White"
              BorderThickness="0">
        <Button.Style>
          <Style TargetType="Button">
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="Button">
                  <Border Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          CornerRadius="5">
                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                  </Border>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
            <Style.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="#218838"/>
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#1E7E34"/>
              </Trigger>
            </Style.Triggers>
          </Style>
        </Button.Style>
      </Button>
    </Grid>

    <!-- Main Content Area -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="5"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Window List (Left) - Using Custom Control -->
      <controls:WindowListControl Grid.Column="0"
                                  Windows="{Binding Windows}"
                                  SelectedWindow="{Binding SelectedWindow, Mode=TwoWay}"/>

      <!-- Splitter -->
      <GridSplitter Grid.Column="1"
                    Width="5"
                    HorizontalAlignment="Stretch"
                    Background="LightGray"/>

      <!-- Image Settings (Right) -->
      <Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel>
            <TextBlock Text="이미지 기반 설정"
                       FontSize="18"
                       FontWeight="Bold"
                       Margin="0,0,0,10"/>

            <!-- Selected Window Info -->
            <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,0,10" Background="WhiteSmoke">
              <StackPanel>
                <TextBlock Text="선택된 윈도우" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding SelectedWindow.Title}" TextWrapping="Wrap" Margin="0,0,0,3"/>
                <TextBlock FontSize="11" Foreground="Gray">
                  <Run Text="클래스: "/>
                  <Run Text="{Binding SelectedWindow.ClassName}"/>
                </TextBlock>
              </StackPanel>
            </Border>

            <!-- Name Input -->
            <TextBlock Text="이미지 이름:" Margin="0,0,0,5" FontWeight="SemiBold"/>
            <TextBox Text="{Binding CustomImageName, UpdateSourceTrigger=PropertyChanged}"
                     Margin="0,0,0,10"
                     Height="30"/>

            <!-- Region Specification -->
            <TextBlock Text="이미지 영역 (px):" Margin="0,0,0,5" FontWeight="SemiBold"/>
            <Grid Margin="0,0,0,10">
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="*"/>
              </Grid.ColumnDefinitions>

              <!-- X, Y -->
              <StackPanel Grid.Row="0" Grid.Column="0">
                <TextBlock Text="X:" FontSize="11" Margin="0,0,0,2"/>
                <TextBox Text="{Binding RectX, UpdateSourceTrigger=PropertyChanged}" Height="30"/>
              </StackPanel>
              <StackPanel Grid.Row="0" Grid.Column="2">
                <TextBlock Text="Y:" FontSize="11" Margin="0,0,0,2"/>
                <TextBox Text="{Binding RectY, UpdateSourceTrigger=PropertyChanged}" Height="30"/>
              </StackPanel>

              <!-- Width, Height -->
              <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,5,0,0">
                <TextBlock Text="Width:" FontSize="11" Margin="0,0,0,2"/>
                <TextBox Text="{Binding RectWidth, UpdateSourceTrigger=PropertyChanged}" Height="30"/>
              </StackPanel>
              <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,5,0,0">
                <TextBlock Text="Height:" FontSize="11" Margin="0,0,0,2"/>
                <TextBox Text="{Binding RectHeight, UpdateSourceTrigger=PropertyChanged}" Height="30"/>
              </StackPanel>
            </Grid>

            <!-- Original Image -->
            <TextBlock Text="원본 이미지:" FontWeight="SemiBold" Margin="0,0,0,5"/>
            <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="3" Margin="0,0,0,10" Height="200">
              <Image Source="{Binding SelectedWindowImage}"
                     Stretch="Uniform"
                     RenderOptions.BitmapScalingMode="HighQuality"/>
            </Border>

            <!-- Cropped Image Preview -->
            <TextBlock Text="잘라진 영역 미리보기:" FontWeight="SemiBold" Margin="0,0,0,5"/>
            <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="3" Height="150">
              <Grid>
                <Image Source="{Binding CroppedImage}"
                       Stretch="Uniform"
                       RenderOptions.BitmapScalingMode="HighQuality"/>
                <TextBlock Text="영역을 지정하면 자동으로 미리보기가 표시됩니다"
                           Foreground="Gray"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center">
                  <TextBlock.Style>
                    <Style TargetType="TextBlock">
                      <Setter Property="Visibility" Value="Collapsed"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding CroppedImage}" Value="{x:Null}">
                          <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </TextBlock.Style>
                </TextBlock>
              </Grid>
            </Border>

            <!-- Settings Info -->
            <Border BorderBrush="#2196F3" BorderThickness="2" CornerRadius="5" Padding="10" Margin="0,15,0,0" Background="#E3F2FD">
              <StackPanel>
                <TextBlock Text="현재 설정 값" FontWeight="Bold" Foreground="#1976D2" Margin="0,0,0,5"/>
                <TextBlock FontSize="11" Foreground="#424242" TextWrapping="Wrap">
                  <Run Text="이름: " FontWeight="SemiBold"/>
                  <Run Text="{Binding CustomImageName}"/>
                </TextBlock>
                <TextBlock FontSize="11" Foreground="#424242" TextWrapping="Wrap" Margin="0,2,0,0">
                  <Run Text="영역: " FontWeight="SemiBold"/>
                  <Run Text="{Binding CustomImageRect}"/>
                </TextBlock>
              </StackPanel>
            </Border>
          </StackPanel>
        </ScrollViewer>
      </Border>
    </Grid>
  </Grid>
</Window>
