<Window x:Class="SpeechAgent.Features.Settings.FindWin.FindWinView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpeechAgent.Features.Settings.FindWin"
        mc:Ignorable="d"
        Title="윈도우 찾기" Height="800" Width="1400"
  WindowStartupLocation="CenterScreen" d:DataContext="{d:DesignInstance Type=local:FindWinViewModel}">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
    <Style x:Key="CustomButtonStyle" TargetType="Button">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    BorderBrush="{TemplateBinding BorderBrush}" 
                    BorderThickness="{TemplateBinding BorderThickness}" 
                    CornerRadius="5">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#005A9E"/>
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
          <Setter Property="Background" Value="#004080"/>
        </Trigger>
      </Style.Triggers>
    </Style>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- 상단 컨트롤 영역 -->
    <Grid Grid.Row="0" Margin="0,0,0,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- 왼쪽: 스캔 버튼 -->
      <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
        <Button Content="스캔" 
                Command="{Binding StartScanCommand}"
                Width="120" 
                Height="40" 
                Margin="0,0,10,0"
                FontSize="14" 
                FontWeight="Bold"
                Background="#007ACC"
                Foreground="White"
                BorderThickness="0"
                Style="{StaticResource CustomButtonStyle}">
        </Button>
        <TextBlock Text="로딩 중..." 
                   VerticalAlignment="Center" 
                   Margin="20,0,0,0"
                   FontSize="14"
                   Foreground="Gray"
                   Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>
      </StackPanel>

      <!-- 오른쪽: 차트번호와 수진자명 가로로 -->
      <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
        <!-- 차트번호 -->
        <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,0,10,0" Background="WhiteSmoke">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="차트번호" Margin="0,0,10,0" VerticalAlignment="Center" FontWeight="SemiBold"/>
            <TextBlock Text="컨트롤:" Margin="0,0,5,0" VerticalAlignment="Center" FontSize="12"/>
            <TextBlock Text="{Binding ChartNumberControlType}" Width="120" Margin="0,0,10,0" VerticalAlignment="Center" FontSize="12" Background="WhiteSmoke" Padding="5"/>
            <TextBlock Text="인덱스:" Margin="0,0,5,0" VerticalAlignment="Center" FontSize="12"/>
            <TextBlock Text="{Binding ChartNumberIndex}" Width="60" VerticalAlignment="Center" FontSize="12" Background="WhiteSmoke" Padding="5"/>
          </StackPanel>
        </Border>

        <!-- 수진자명 -->
        <Border BorderBrush="LightGray" BorderThickness="1" CornerRadius="5" Padding="10" Background="WhiteSmoke">
          <StackPanel Orientation="Horizontal">
            <TextBlock Text="수진자명" Margin="0,0,10,0" VerticalAlignment="Center" FontWeight="SemiBold"/>
            <TextBlock Text="컨트롤:" Margin="0,0,5,0" VerticalAlignment="Center" FontSize="12"/>
            <TextBlock Text="{Binding PatientNameControlType}" Width="120" Margin="0,0,10,0" VerticalAlignment="Center" FontSize="12" Background="WhiteSmoke" Padding="5"/>
            <TextBlock Text="인덱스:" Margin="0,0,5,0" VerticalAlignment="Center" FontSize="12"/>
            <TextBlock Text="{Binding PatientNameIndex}" Width="60" VerticalAlignment="Center" FontSize="12" Background="WhiteSmoke" Padding="5"/>
          </StackPanel>
        </Border>

        <!-- 설정으로 전송 버튼 -->
        <Button Content="설정으로 전송" 
                Command="{Binding SendToSettingsCommand}"
                Width="120" 
                Height="40" 
                Margin="10,0,0,0"
                FontSize="14" 
                FontWeight="Bold"
                Background="#28A745"
                Foreground="White"
                BorderThickness="0"
                Style="{StaticResource CustomButtonStyle}">
        </Button>
      </StackPanel>
    </Grid>

    <!-- 메인 콘텐츠 영역 -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="5"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- 윈도우 목록 (왼쪽) -->
      <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="5">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <ListBox ItemsSource="{Binding Windows}"
         SelectedItem="{Binding SelectedWindow}"
      BorderThickness="0"
        Background="Transparent">
            <ListBox.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="LightGray" 
                        BorderThickness="1" 
                        Margin="5" 
                        CornerRadius="5"
                        Background="White"
                        Width="420"
                        Cursor="Hand">
                  <Border.Style>
                    <Style TargetType="Border">
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                          <Setter Property="Background" Value="LightBlue"/>
                        </DataTrigger>
                        <Trigger Property="IsMouseOver" Value="True">
                          <Setter Property="Background" Value="LightYellow"/>
                        </Trigger>
                      </Style.Triggers>
                    </Style>
                  </Border.Style>
                  <StackPanel Margin="10">
                    <!-- 스크린샷 -->
                    <Image Source="{Binding Screenshot}"                              
                           RenderOptions.BitmapScalingMode="HighQuality"
                           MaxHeight="238"
                           Margin="0,0,0,10"/>
                    <!-- 윈도우 정보 -->
                    <TextBlock Text="{Binding Title}" 
                               FontWeight="Bold" 
                               FontSize="12"
                               TextWrapping="Wrap"
                               Margin="0,0,0,5"/>
                    <TextBlock FontSize="10" Foreground="Gray">
                      <Run Text="Process: "/>
                      <Run Text="{Binding ProcessName}"/>
                    </TextBlock>
                    <TextBlock Text="{Binding ClassName}" 
                               FontSize="10" 
                               Foreground="Gray"
                               TextWrapping="Wrap"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem">
                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <ContentPresenter/>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ListBox.ItemContainerStyle>
          </ListBox>
        </ScrollViewer>
      </Border>

      <!-- 구분선 -->
      <GridSplitter Grid.Column="1" 
                    Width="5" 
                    HorizontalAlignment="Stretch" 
                    Background="LightGray"/>

      <!-- 세부 정보 (오른쪽) -->
      <Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

          <!-- 헤더 -->
          <StackPanel Grid.Row="0" Margin="0,0,0,5">
            <TextBlock Text="선택된 윈도우의 컨트롤 목록" 
                       FontSize="18" 
                       FontWeight="Bold" 
                       Margin="0,0,0,3"/>
            <TextBlock Text="{Binding SelectedWindow.Title}" 
                       FontSize="14" 
                       Foreground="Gray"
                       TextWrapping="Wrap"
                       Margin="0,0,0,3"/>
            <TextBlock FontSize="12" Foreground="Gray">
              <Run Text="총 "/>
              <Run Text="{Binding SearchedControls.Count, Mode=OneWay}" FontWeight="Bold"/>
              <Run Text="개의 컨트롤"/>
            </TextBlock>
            <TextBlock Text="컨트롤 검색 중..." 
                       FontSize="12" 
                       Foreground="Blue"
                       Margin="0,5,0,0"
                       Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>
            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
              <TextBlock Text="텍스트 검색" 
                         FontSize="12" 
                         Foreground="Gray"
                         VerticalAlignment="Center"/>
              <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged, TargetNullValue='', FallbackValue=''}"
                       Width="200" 
                       Margin="10,0,0,0" 
                       FontSize="14" 
                       VerticalContentAlignment="Center">
                <TextBox.InputBindings>
                  <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                </TextBox.InputBindings>
              </TextBox>
              <Button Content="검색" 
                      Command="{Binding SearchCommand}"
                      Width="60" 
                      Height="30" 
                      Margin="10,0,0,0"
                      FontSize="12"
                      Background="#007ACC"
                      Foreground="White"
                      BorderThickness="0"
                      Style="{StaticResource CustomButtonStyle}">
              </Button>
            </StackPanel>
          </StackPanel>

          <!-- 컨트롤 목록 -->
          <ListBox 
            Grid.Row="1"
            ItemsSource="{Binding SearchedControls}" 
            BorderThickness="0" 
            Background="Transparent"
            ScrollViewer.CanContentScroll="True"
            VirtualizingPanel.IsVirtualizing="True"
            VirtualizingPanel.VirtualizationMode="Recycling">
            <ListBox.ItemsPanel>
              <ItemsPanelTemplate>
                <VirtualizingStackPanel/>
              </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border Background="White"
                          BorderBrush="#E0E0E0"
                          BorderThickness="1"
                          Margin="0,0,0,2"
                          Padding="4"
                          CornerRadius="3">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*"/>
                      <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                      <TextBlock FontSize="12" Text="{Binding DisplayText, Mode=OneWay}" TextWrapping="Wrap" Foreground="#333"/>
                      <TextBlock FontSize="12" TextWrapping="Wrap">
                          <Run Text="Text: " Foreground="#555"/>
                          <Run Text="{Binding Text, Mode=OneWay}" Foreground="Blue" FontWeight="Bold"/>
                      </TextBlock>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center" Margin="10,0,0,0">
                      <Button Content="차트" 
                              Command="{Binding DataContext.AssignToChartCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" 
                              CommandParameter="{Binding}"
                              Width="40" 
                              Height="25" 
                              Margin="0,0,0,5"
                              FontSize="10"
                              Background="#007ACC"
                              Foreground="White"
                              BorderThickness="0"
                              HorizontalAlignment="Center"
                              Style="{StaticResource CustomButtonStyle}"/>
                      <Button Content="이름" 
                              Command="{Binding DataContext.AssignToNameCommand, RelativeSource={RelativeSource AncestorType=ListBox}}" 
                              CommandParameter="{Binding}"
                              Width="40" 
                              Height="25" 
                              FontSize="10"
                              Background="#28A745"
                              Foreground="White"
                              BorderThickness="0"
                              HorizontalAlignment="Center"
                              Style="{StaticResource CustomButtonStyle}"/>
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem">
                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <ContentPresenter/>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ListBox.ItemContainerStyle>
          </ListBox>

          <!-- 빈 상태 메시지 -->
          <TextBlock Grid.Row="1"
                     Text="윈도우를 선택하면 컨트롤 목록이 표시됩니다." 
                     Foreground="Gray"
                     FontSize="13"
                     TextWrapping="Wrap"
                     HorizontalAlignment="Center"
                     VerticalAlignment="Center">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility" Value="Collapsed"/>
                <Style.Triggers>
                  <DataTrigger Binding="{Binding SearchedControls.Count}" Value="0">
                    <Setter Property="Visibility" Value="Visible"/>
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </Grid>
      </Border>
    </Grid>
  </Grid>
</Window>
