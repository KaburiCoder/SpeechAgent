<Window x:Class="SpeechAgent.Features.Settings.FindWin.FindWinView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpeechAgent.Features.Settings.FindWin"
        mc:Ignorable="d"
        Title="윈도우 찾기" Height="700" Width="1200"
  WindowStartupLocation="CenterScreen">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <!-- 상단 컨트롤 영역 -->
    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
      <Button Content="스캔 시작" 
          Command="{Binding StartScanCommand}"
     Width="100" Height="35" Margin="0,0,10,0"
       FontSize="14" FontWeight="Bold"/>
      <Button Content="새로고침" 
        Command="{Binding RefreshCommand}"
            Width="100" Height="35"
    FontSize="14"/>
      <TextBlock Text="로딩 중..." 
           VerticalAlignment="Center" 
          Margin="20,0,0,0"
           FontSize="14"
    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>
    </StackPanel>

    <!-- 메인 콘텐츠 영역 -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*"/>
        <ColumnDefinition Width="5"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- 윈도우 목록 (왼쪽) -->
      <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="5">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
          <ListBox ItemsSource="{Binding Windows}"
         SelectedItem="{Binding SelectedWindow}"
      BorderThickness="0"
        Background="Transparent">
            <ListBox.ItemsPanel>
              <ItemsPanelTemplate>
                <WrapPanel Orientation="Horizontal"/>
              </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border BorderBrush="LightGray" 
                        BorderThickness="1" 
                        Margin="5" 
                        CornerRadius="5"
                        Background="White"
                        Width="280"
                        Cursor="Hand">
                  <Border.Style>
                    <Style TargetType="Border">
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                          <Setter Property="Background" Value="LightBlue"/>
                        </DataTrigger>
                        <Trigger Property="IsMouseOver" Value="True">
                          <Setter Property="Background" Value="LightYellow"/>
                        </Trigger>
                      </Style.Triggers>
                    </Style>
                  </Border.Style>
                  <StackPanel Margin="10">
                    <!-- 스크린샷 -->
                    <Image Source="{Binding Screenshot}"   
                           Stretch="Uniform" 
                           MaxHeight="150"
                           Margin="0,0,0,10"/>
                    <!-- 윈도우 정보 -->
                    <TextBlock Text="{Binding Title}" 
                               FontWeight="Bold" 
                               FontSize="12"
                               TextWrapping="Wrap"
                               Margin="0,0,0,5"/>
                    <TextBlock FontSize="10" Foreground="Gray">
                      <Run Text="Process: "/>
                      <Run Text="{Binding ProcessName}"/>
                    </TextBlock>
                    <TextBlock Text="{Binding ClassName}" 
                               FontSize="10" 
                               Foreground="Gray"
                               TextWrapping="Wrap"/>
                  </StackPanel>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem">
                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <ContentPresenter/>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ListBox.ItemContainerStyle>
          </ListBox>
        </ScrollViewer>
      </Border>

      <!-- 구분선 -->
      <GridSplitter Grid.Column="1" 
                    Width="5" 
                    HorizontalAlignment="Stretch" 
                    Background="LightGray"/>

      <!-- 세부 정보 (오른쪽) -->
      <Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel>
            <TextBlock Text="선택된 윈도우 정보" 
                       FontSize="16" 
                       FontWeight="Bold" 
                       Margin="0,0,0,15"/>

            <StackPanel Visibility="{Binding DetailedWindowInfo, 
         Converter={StaticResource BoolToVisibility}}">
              <!-- 스크린샷 -->
              <TextBlock Text="스크린샷:" FontWeight="Bold" Margin="0,0,0,5"/>
              <Image Source="{Binding DetailedWindowInfo.Screenshot}" 
                     Stretch="Uniform" 
                     MaxHeight="200"
                     Margin="0,0,0,15"/>

              <!-- 윈도우 타이틀 -->
              <TextBlock Text="Title:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.Title}" 
                         TextWrapping="Wrap" 
                         Margin="0,0,0,10"/>

              <!-- 클래스 이름 -->
              <TextBlock Text="Class Name:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.ClassName}" 
                         TextWrapping="Wrap" 
                         Margin="0,0,0,10"/>

              <!-- 프로세스 이름 -->
              <TextBlock Text="Process Name:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.ProcessName}" 
                         Margin="0,0,0,10"/>

              <!-- 프로세스 ID -->
              <TextBlock Text="Process ID:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.ProcessId}" 
                         Margin="0,0,0,10"/>

              <!-- 핸들 -->
              <TextBlock Text="Window Handle:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.Handle}" 
                         Margin="0,0,0,10"/>

              <!-- 크기 -->
              <TextBlock Text="Size:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Margin="0,0,0,10">
                <Run Text="Width: "/>
                <Run Text="{Binding DetailedWindowInfo.Width}"/>
                <Run Text=" x Height: "/>
                <Run Text="{Binding DetailedWindowInfo.Height}"/>
              </TextBlock>

              <!-- 가시성 -->
              <TextBlock Text="Visible:" FontWeight="Bold" Margin="0,0,0,5"/>
              <TextBlock Text="{Binding DetailedWindowInfo.IsVisible}" 
                         Margin="0,0,0,10"/>
            </StackPanel>

            <TextBlock Text="윈도우를 선택하면 세부 정보가 표시됩니다." 
                       Foreground="Gray"
                       TextWrapping="Wrap"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Margin="0,50,0,0">
              <TextBlock.Style>
                <Style TargetType="TextBlock">
                  <Setter Property="Visibility" Value="Collapsed"/>
                  <Style.Triggers>
                    <DataTrigger Binding="{Binding DetailedWindowInfo}" Value="{x:Null}">
                      <Setter Property="Visibility" Value="Visible"/>
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </TextBlock.Style>
            </TextBlock>
          </StackPanel>
        </ScrollViewer>
      </Border>
    </Grid>
  </Grid>
</Window>
