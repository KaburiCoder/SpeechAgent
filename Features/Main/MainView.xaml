<Window
  x:Class="SpeechAgent.Features.Main.MainView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:SpeechAgent.Features.Main"
  xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="clr-namespace:SpeechAgent.Features.Main"
  Title="Voice Medic Agent"
  Width="400"
  Height="450"
  AllowsTransparency="True"
  Background="Transparent"
  ResizeMode="CanResize"
  WindowStartupLocation="CenterScreen"
  WindowStyle="None"
  mc:Ignorable="d">

  <!--  전체 윈도우를 위한 둥근 테두리와 그림자  -->
  <Border
    Background="White"
    BorderBrush="#E0E0E0"
    BorderThickness="1"
    CornerRadius="12">
    <Border.Effect>
      <DropShadowEffect
        BlurRadius="15"
        Direction="270"
        Opacity="0.2"
        ShadowDepth="4"
        Color="#000000" />
    </Border.Effect>

    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <!--  커스텀 타이틀바  -->
      <Border
        Grid.Row="0"
        Background="#2196F3"
        CornerRadius="12,12,0,0"
        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
        <Grid Height="45">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <!--  앱 아이콘  -->
          <materialDesign:PackIcon
            Grid.Column="0"
            Width="24"
            Height="24"
            Margin="15,0,10,0"
            VerticalAlignment="Center"
            Foreground="White"
            Kind="Microphone" />

          <!--  타이틀  -->
          <TextBlock
            Grid.Column="1"
            VerticalAlignment="Center"
            FontSize="16"
            FontWeight="Medium"
            Foreground="White"
            Text="Voice Medic Agent" />

          <!--  단축키 버튼  -->
          <Button
            Grid.Column="2"
            Width="35"
            Height="35"
            Margin="5,0"
            Command="{Binding ShowShortcutSettingsCommand}"
            Foreground="White"
            Style="{StaticResource MaterialDesignIconButton}"
            ToolTip="설정">
            <materialDesign:PackIcon
              Width="18"
              Height="18"
              Kind="Keyboard" />
          </Button>
          <!--  설정 버튼  -->
          <Button
            Grid.Column="3"
            Width="35"
            Height="35"
            Margin="5,0"
            Command="{Binding ShowSettingsCommand}"
            Foreground="White"
            Style="{StaticResource MaterialDesignIconButton}"
            ToolTip="설정">
            <materialDesign:PackIcon
              Width="18"
              Height="18"
              Kind="CogOutline" />
          </Button>

          <!--  Tray 버튼  -->
          <Button
            Grid.Column="4"
            Width="35"
            Height="35"
            Margin="0,0,10,0"
            Click="CloseButton_Click"
            Foreground="White"
            Style="{StaticResource MaterialDesignIconButton}"
            ToolTip="Tray로">
            <materialDesign:PackIcon
              Width="16"
              Height="16"
              Kind="WindowMinimize" />
          </Button>
        </Grid>
      </Border>

      <!--  메인 콘텐츠 영역  -->
      <Grid Grid.Row="1" Margin="15">
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  상태 정보 카드  -->
        <Border
          Grid.Row="0"
          Margin="0,0,0,10"
          Padding="12"
          Background="#F8F9FA"
          CornerRadius="8">
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
              <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!--  서버 연결 상태  -->
            <Grid Grid.Row="0" Margin="0,0,0,6">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>

              <Ellipse
                Grid.Column="0"
                Width="8"
                Height="8"
                Margin="0,0,8,0"
                VerticalAlignment="Center">
                <Ellipse.Fill>
                  <SolidColorBrush Color="{Binding IsSIOConnected, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='#4CAF50,#F44336'}" />
                </Ellipse.Fill>
              </Ellipse>

              <TextBlock
                Grid.Column="1"
                VerticalAlignment="Center"
                FontSize="13"
                Foreground="#424242"
                Text="서버 연결" />
            </Grid>

            <!--  방 접속 상태  -->
            <Grid Grid.Row="1" Margin="0,0,0,6">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
              </Grid.ColumnDefinitions>

              <Ellipse
                Grid.Column="0"
                Width="8"
                Height="8"
                Margin="0,0,8,0"
                VerticalAlignment="Center">
                <Ellipse.Fill>
                  <SolidColorBrush Color="{Binding IsJoinedRoom, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='#4CAF50,#F44336'}" />
                </Ellipse.Fill>
              </Ellipse>

              <TextBlock
                Grid.Column="1"
                VerticalAlignment="Center"
                FontSize="13"
                Foreground="#424242"
                Text="방 접속" />
            </Grid>

            <!--  웹 Ping 상태  -->
            <Grid Grid.Row="2">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
              </Grid.ColumnDefinitions>

              <Ellipse
                Grid.Column="0"
                Width="8"
                Height="8"
                Margin="0,0,8,0"
                VerticalAlignment="Center">
                <Ellipse.Fill>
                  <SolidColorBrush Color="{Binding IsPingHealthy, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='#4CAF50,#F44336'}" />
                </Ellipse.Fill>
              </Ellipse>

              <TextBlock
                Grid.Column="1"
                VerticalAlignment="Center"
                FontSize="13"
                Foreground="#424242"
                Text="웹 연결" />

              <TextBlock
                Grid.Column="2"
                VerticalAlignment="Center"
                FontSize="11"
                Foreground="#9E9E9E"
                Text="{Binding PingStatusText}" />
            </Grid>
          </Grid>
        </Border>

        <!--  환자 정보 리스트  -->
        <Border
          Grid.Row="1"
          Padding="8"
          Background="#FAFAFA"
          CornerRadius="8">
          <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding PatInfos}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <Border
                    Margin="0,0,0,6"
                    Padding="12,8"
                    Background="White"
                    CornerRadius="6">
                    <Border.Effect>
                      <DropShadowEffect
                        BlurRadius="3"
                        Direction="270"
                        Opacity="0.1"
                        ShadowDepth="1"
                        Color="#000000" />
                    </Border.Effect>

                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                      </Grid.ColumnDefinitions>

                      <TextBlock
                        Grid.Column="0"
                        VerticalAlignment="Center"
                        FontSize="14"
                        FontWeight="SemiBold"
                        Foreground="#2196F3"
                        Text="{Binding Chart}" />

                      <TextBlock
                        Grid.Column="1"
                        Margin="12,0,0,0"
                        VerticalAlignment="Center"
                        FontSize="13"
                        Foreground="#424242"
                        Text="{Binding Name}" />

                      <TextBlock
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        FontSize="11"
                        Foreground="#9E9E9E"
                        Text="{Binding Timestamp, StringFormat='HH:mm:ss'}" />
                    </Grid>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>
        </Border>
      </Grid>
    </Grid>
  </Border>
</Window>
