<Window
  x:Class="SpeechAgent.Features.Settings.FindWin.FindWinApiView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="clr-namespace:SpeechAgent.Features.Settings.FindWin.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:local="clr-namespace:SpeechAgent.Features.Settings.FindWin"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  Title="윈도우 찾기"
  Width="1400"
  Height="800"
  d:DataContext="{d:DesignInstance Type=local:FindWinApiViewModel}"
  WindowStartupLocation="CenterScreen"
  mc:Ignorable="d">
  <Window.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    <Style x:Key="CustomButtonStyle" TargetType="Button">
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              Background="{TemplateBinding Background}"
              BorderBrush="{TemplateBinding BorderBrush}"
              BorderThickness="{TemplateBinding BorderThickness}"
              CornerRadius="5">
              <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
            </Border>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
      <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
          <Setter Property="Background" Value="#005A9E" />
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
          <Setter Property="Background" Value="#004080" />
        </Trigger>
      </Style.Triggers>
    </Style>
  </Window.Resources>

  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
    </Grid.RowDefinitions>

    <!--  상단 컨트롤 영역  -->
    <Grid Grid.Row="0" Margin="0,0,0,10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!--  왼쪽: 스캔 버튼  -->
      <controls:ScanButton
        Grid.Column="0"
        ButtonText="스캔"
        Command="{Binding StartScanCommand}"
        IsLoading="{Binding IsLoading}"
        LoadingText="로딩 중..." />

      <!--  오른쪽: 차트번호와 수진자명 가로로  -->
      <StackPanel
        Grid.Column="1"
        HorizontalAlignment="Right"
        VerticalAlignment="Center"
        Orientation="Horizontal">
        <!--  차트번호  -->
        <controls:ControlPosBox
          Title="차트번호"
          Margin="0,0,10,0"
          ControlType="{Binding ChartNumberControlType}"
          Index="{Binding ChartNumberIndex}" />

        <!--  수진자명  -->
        <controls:ControlPosBox
          Title="수진자명"
          Margin="0,0,10,0"
          ControlType="{Binding PatientNameControlType}"
          Index="{Binding PatientNameIndex}" />

        <!--  설정으로 전송 버튼  -->
        <Button
          Width="120"
          Height="40"
          Margin="10,0,0,0"
          Background="#28A745"
          BorderThickness="0"
          Command="{Binding SendToSettingsCommand}"
          Content="설정으로 전송"
          FontSize="14"
          FontWeight="Bold"
          Foreground="White"
          Style="{StaticResource CustomButtonStyle}" />
      </StackPanel>
    </Grid>

    <!--  메인 콘텐츠 영역  -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="2*" />
        <ColumnDefinition Width="5" />
        <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>

      <!--  윈도우 목록 (왼쪽)  -->
      <controls:WindowListControl
        Grid.Column="0"
        SelectedWindow="{Binding SelectedWindow, Mode=TwoWay}"
        Windows="{Binding Windows}" />
      <!--  구분선  -->
      <GridSplitter
        Grid.Column="1"
        Width="5"
        HorizontalAlignment="Stretch"
        Background="LightGray" />

      <!--  세부 정보 (오른쪽)  -->
      <Border
        Grid.Column="2"
        Padding="10"
        BorderBrush="Gray"
        BorderThickness="1"
        CornerRadius="5">
        <Grid>
          <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
          </Grid.RowDefinitions>

          <!--  헤더  -->
          <controls:ControlListHeader
            Title="선택된 윈도우의 컨트롤 목록"
            Grid.Row="0"
            ControlCount="{Binding SearchedControls.Count, Mode=OneWay}"
            IsLoading="{Binding IsLoading}"
            LoadingText="컨트롤 검색 중..."
            SearchButtonText="검색"
            SearchCommand="{Binding SearchCommand}"
            SearchLabel="텍스트 검색"
            SearchText="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
            WindowTitle="{Binding SelectedWindow.Title}" />

          <!--  컨트롤 목록  -->
          <ListBox
            Grid.Row="1"
            Background="Transparent"
            BorderThickness="0"
            ItemsSource="{Binding SearchedControls}"
            ScrollViewer.CanContentScroll="True"
            VirtualizingPanel.IsVirtualizing="True"
            VirtualizingPanel.VirtualizationMode="Recycling">
            <ListBox.ItemsPanel>
              <ItemsPanelTemplate>
                <VirtualizingStackPanel />
              </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
              <DataTemplate>
                <Border
                  Margin="0,0,0,2"
                  Padding="4"
                  Background="White"
                  BorderBrush="#E0E0E0"
                  BorderThickness="1"
                  CornerRadius="3">
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="*" />
                      <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0">
                      <TextBlock
                        FontSize="12"
                        Foreground="#333"
                        Text="{Binding DisplayText, Mode=OneWay}"
                        TextWrapping="Wrap" />
                      <TextBlock FontSize="12" TextWrapping="Wrap">
                        <Run Foreground="#555" Text="Text: " />
                        <Run
                          FontWeight="Bold"
                          Foreground="Blue"
                          Text="{Binding Text, Mode=OneWay}" />
                      </TextBlock>
                    </StackPanel>
                    <StackPanel
                      Grid.Column="1"
                      Margin="10,0,0,0"
                      VerticalAlignment="Center"
                      Orientation="Vertical">
                      <Button
                        Width="40"
                        Height="25"
                        Margin="0,0,0,5"
                        HorizontalAlignment="Center"
                        Background="#007ACC"
                        BorderThickness="0"
                        Command="{Binding DataContext.AssignToChartCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                        CommandParameter="{Binding}"
                        Content="차트"
                        FontSize="10"
                        Foreground="White"
                        Style="{StaticResource CustomButtonStyle}" />
                      <Button
                        Width="40"
                        Height="25"
                        HorizontalAlignment="Center"
                        Background="#28A745"
                        BorderThickness="0"
                        Command="{Binding DataContext.AssignToNameCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                        CommandParameter="{Binding}"
                        Content="이름"
                        FontSize="10"
                        Foreground="White"
                        Style="{StaticResource CustomButtonStyle}" />
                    </StackPanel>
                  </Grid>
                </Border>
              </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
              <Style TargetType="ListBoxItem">
                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                      <ContentPresenter />
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>
            </ListBox.ItemContainerStyle>
          </ListBox>

          <!--  빈 상태 메시지  -->
          <TextBlock
            Grid.Row="1"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            FontSize="13"
            Foreground="Gray"
            Text="윈도우를 선택하면 컨트롤 목록이 표시됩니다."
            TextWrapping="Wrap">
            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="Visibility" Value="Collapsed" />
                <Style.Triggers>
                  <DataTrigger Binding="{Binding SearchedControls.Count}" Value="0">
                    <Setter Property="Visibility" Value="Visible" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>
          </TextBlock>
        </Grid>
      </Border>
    </Grid>
  </Grid>
</Window>
