<Window x:Class="SpeechAgent.Features.Settings.SettingsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SpeechAgent.Features.Settings"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:vm="clr-namespace:SpeechAgent.Features.Settings"
        d:DataContext="{d:DesignInstance vm:SettingsViewModel}"
        mc:Ignorable="d" 
        Title="Voice Medic Settings" Height="600" Width="400"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">

  <!-- 전체 윈도우를 위한 둥근 테두리와 그림자 -->
  <Border Background="White" 
          CornerRadius="8" 
          BorderBrush="#E0E0E0" 
          BorderThickness="1">
    <Border.Effect>
      <DropShadowEffect Color="#000000" 
                        Direction="270" 
                        ShadowDepth="3" 
                        BlurRadius="10" 
                        Opacity="0.18"/>
    </Border.Effect>

    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <!-- 커스텀 타이틀바 -->
      <Border Grid.Row="0" 
          Background="#2196F3" 
          CornerRadius="8,8,0,0" 
          MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
        <Grid Height="36">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <!-- 앱 아이콘 -->
          <materialDesign:PackIcon Grid.Column="0" 
                                   Kind="CogOutline" 
                                   Width="20" Height="20" 
                                   Foreground="White" 
                                   VerticalAlignment="Center" 
                                   Margin="10,0,6,0"/>

          <!-- 타이틀 -->
          <TextBlock Grid.Column="1" 
                     Text="Voice Medic Settings" 
                     FontSize="14" 
                     FontWeight="Medium" 
                     Foreground="White" 
                     VerticalAlignment="Center"/>

          <!-- 닫기 버튼 -->
          <Button Grid.Column="2" 
                  Click="CloseButton_Click"
                  ToolTip="닫기"
                  Margin="0,0,6,0"
                  Width="28" Height="28"
                  Style="{StaticResource MaterialDesignIconButton}"
                  Foreground="White">
            <materialDesign:PackIcon Kind="Close" Width="15" Height="15" />
          </Button>
        </Grid>
      </Border>

      <!-- 메인 콘텐츠 영역 -->
      <Grid Grid.Row="1" Margin="12">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
          <StackPanel>
          <!-- 연결 키 섹션 -->
          <Border Background="#F8F9FA" 
                  CornerRadius="5" 
                  Padding="10" 
                  Margin="0,0,0,10">
            <StackPanel>
              <TextBlock Text="연결 키" 
                         FontSize="12" 
                         FontWeight="SemiBold"
                         Foreground="#424242"
                         Margin="0,0,0,6"/>
              <TextBox materialDesign:HintAssist.Hint="Connect Key를 입력하세요" 
                        Text="{Binding ConnectKey, UpdateSourceTrigger=PropertyChanged}"/>
            </StackPanel>
          </Border>

          <!-- 앱 선택 섹션 -->
          <Border Background="#F8F9FA" 
                  CornerRadius="5" 
                  Padding="10" 
                  Margin="0,0,0,10">
            <StackPanel>
              <TextBlock Text="앱 선택" 
                         FontSize="12" 
                         FontWeight="SemiBold"
                         Foreground="#424242"
                         Margin="0,0,0,6"/>
              <ComboBox materialDesign:HintAssist.Hint="앱을 선택하세요" 
                        ItemsSource="{Binding Options}" 
                        DisplayMemberPath="Key" 
                        SelectedItem="{Binding SelectedOption}"/>
            </StackPanel>
          </Border>

          <!-- 사용자 정의 섹션 -->
          <Border Background="#F8F9FA" 
                  CornerRadius="5" 
                  Padding="10" 
                  Margin="0,0,0,10"
                  Visibility="{Binding IsCustomSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
              <TextBlock Text="사용자 정의 설정" 
                         FontSize="12" 
                         FontWeight="SemiBold"
                         Foreground="#424242"
                         Margin="0,0,0,6"/>
              <TextBox materialDesign:HintAssist.Hint="EXE 타이틀" 
                       Text="{Binding ExeTitle, UpdateSourceTrigger=PropertyChanged}"
                       Margin="0,0,0,6"/>
              <Grid Margin="0,0,0,6">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="10"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" materialDesign:HintAssist.Hint="차트 컨트롤" 
                         Text="{Binding ChartControlType, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox Grid.Column="2" materialDesign:HintAssist.Hint="Index" 
                         Text="{Binding ChartIndex, UpdateSourceTrigger=PropertyChanged}"
                         PreviewTextInput="Index_PreviewTextInput"/>
              </Grid>
              <Grid Margin="0,0,0,6">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*"/>
                  <ColumnDefinition Width="10"/>
                  <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBox Grid.Column="0" materialDesign:HintAssist.Hint="이름 컨트롤" 
                         Text="{Binding NameControlType, UpdateSourceTrigger=PropertyChanged}"/>
                <TextBox Grid.Column="2" materialDesign:HintAssist.Hint="Index" 
                         Text="{Binding NameIndex, UpdateSourceTrigger=PropertyChanged}"
                         PreviewTextInput="Index_PreviewTextInput"/>
              </Grid>
              <Button Command="{Binding FindControlCommand}"
                      Margin="0,6,0,0">
                컨트롤 찾기
              </Button>
            </StackPanel>
          </Border>

          <!-- 사용자 이미지 설정 섹션 -->
          <Border Background="#F8F9FA" 
                  CornerRadius="5" 
                  Padding="10" 
                  Margin="0,0,0,10"
                  Visibility="{Binding IsCustomImageSelected, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel>
              <TextBlock Text="사용자 이미지 설정" 
                         FontSize="12" 
                         FontWeight="SemiBold"
                         Foreground="#424242"
                         Margin="0,0,0,6"/>
              <TextBox materialDesign:HintAssist.Hint="이미지 이름" 
                        Text="{Binding CustomImageName, UpdateSourceTrigger=PropertyChanged}"
                        Margin="0,0,0,6"/>
              <TextBox materialDesign:HintAssist.Hint="이미지 영역 (x,y,width,height)" 
                        Text="{Binding CustomImageRect, UpdateSourceTrigger=PropertyChanged}"
                        IsReadOnly="True"
                        Margin="0,0,0,6"/>
              <Button Command="{Binding FindImageControlCommand}"
                      Margin="0,6,0,0">
                이미지 컨트롤 찾기
              </Button>
            </StackPanel>
          </Border>

          <!-- 자동 시작 섹션 -->
          <Border Background="#F8F9FA" 
                  CornerRadius="5" 
                  Padding="10" 
                  Margin="0,0,0,12">
            <StackPanel>
              <TextBlock Text="시스템 설정" 
                         FontSize="12" 
                         FontWeight="SemiBold"
                         Foreground="#424242"
                         Margin="0,0,0,6"/>
              <CheckBox IsChecked="{Binding AutoStartEnabled}"
                        Style="{StaticResource MaterialDesignCheckBox}">
                <StackPanel Orientation="Horizontal">
                  <materialDesign:PackIcon Kind="WindowRestore" 
                                           Width="14" Height="14" 
                                           VerticalAlignment="Center"
                                           Margin="0,0,6,0"
                                           Foreground="#616161"/>
                  <TextBlock Text="윈도우 시작 시 자동 실행" 
                             FontSize="12"
                             Foreground="#424242"
                             VerticalAlignment="Center"/>
                </StackPanel>
              </CheckBox>
            </StackPanel>
          </Border>

          <!-- 버튼 영역 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" 
                   Margin="0,0,3,0" 
                   Height="32"
                   Style="{StaticResource MaterialDesignRaisedButton}"
                   materialDesign:ButtonAssist.CornerRadius="6"
                   Command="{Binding SaveSettingsCommand}">
              <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="ContentSave" 
                                         Width="15" Height="15" 
                                         VerticalAlignment="Center"/>
                <TextBlock Text="저장" 
                          Margin="6,0,0,0" 
                          FontSize="13"
                          VerticalAlignment="Center"/>
              </StackPanel>
            </Button>

            <Button Grid.Column="1" 
                   Margin="3,0,0,0" 
                   Height="32"
                   Style="{StaticResource MaterialDesignOutlinedButton}"
                   materialDesign:ButtonAssist.CornerRadius="6"
                   Command="{Binding CloseCommand}">
              <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="Close" 
                                         Width="15" Height="15" 
                                         VerticalAlignment="Center"/>
                <TextBlock Text="닫기" 
                          Margin="6,0,0,0" 
                          FontSize="13"
                          VerticalAlignment="Center"/>
              </StackPanel>
            </Button>
          </Grid>
        </StackPanel>
      </ScrollViewer>
      </Grid>
    </Grid>
  </Border>
</Window>
